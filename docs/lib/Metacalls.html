<!DOCTYPE html>
<html><head title="Doc"><meta charset="UTF-8"/><link href="../styles.css" rel="stylesheet"/></head><body><nav class="sidebar"><h3>Modules</h3><ul><li><li><a href="../bin/Metacalls.html">bin/Metacalls</a></li></li><li><li><a href="../lib/Common.html">lib/Common</a></li></li><li><li><a href="../lib/IcManagement.html">lib/IcManagement</a></li></li><li><li><a href="../lib/Metacalls.html">lib/Metacalls</a></li></li><li><li><a href="../lib/State.html">lib/State</a></li></li><li><li><a href="../lib/Types.html">lib/Types</a></li></li></ul><h3>Declarations</h3><ul><li><li><a href="#type.MetacallsLib">MetacallsLib</a></li></li><li><li><a href="#init">init</a></li></li><li><li><a href="#createDerivedIdentity">createDerivedIdentity</a></li></li><li><li><a href="#listDerivedIdentities">listDerivedIdentities</a></li></li><li><li><a href="#createMessage">createMessage</a></li></li><li><li><a href="#signMessage">signMessage</a></li></li><li><li><a href="#sendOutgoingMessage">sendOutgoingMessage</a></li></li><li><li><a href="#listMessages">listMessages</a></li></li><li><li><a href="#updateMessageTtl">updateMessageTtl</a></li></li><li><li><a href="#cleanupExpiredMessages">cleanupExpiredMessages</a></li></li></ul></nav><div class="documentation"><h1>lib/Metacalls</h1><p>Stable class adding support for metacalls in Motoko.</p>
<p>TODO</p>
<div class="declaration"><h4 class="type-declaration" id="type.MetacallsLib"><span class="keyword">type </span><span class="type">MetacallsLib</span> = { icManagement : <a href="#type.IcManagement"><span class="type">IcManagement</span></a>; state : <a href="#type.State"><span class="type">State</span></a> }</h4><p></p></div><div class="declaration"><h4 class="function" id="init"><code><span class="keyword">public func </span><span class="fnname">init</span>(<br/>  <span class="parameter">initIcManagement</span> : <a href="#type.IcManagement"><span class="type">IcManagement</span></a>, <br/>  <span class="parameter">env</span> : <a href="#type.Env"><span class="type">Env</span></a>, <br/>  <span class="parameter">http_outcall_cycles</span> : <span class="type">Nat</span><br/>) : <a href="#type.MetacallsLib"><span class="type">MetacallsLib</span></a></code></h4><p><p>Initialize the library by providing it with the required actors and environment.</p>
</p></div><div class="declaration"><h4 class="function" id="createDerivedIdentity"><code><span class="keyword">public func </span><span class="fnname">createDerivedIdentity</span>(<span class="parameter">lib</span> : <a href="#type.MetacallsLib"><span class="type">MetacallsLib</span></a>, <span class="parameter">key_name</span> : <span class="type">Text</span>) : <span class="keyword">async </span><a href="#type.Result"><span class="type">Result</span></a>&lt;<a href="#type.CreateDerivedIdentityResponse"><span class="type">CreateDerivedIdentityResponse</span></a>&gt;</code></h4><p><p>Create a derived identity for the provided principal.</p>
<p>The identity is saved in the state and can be used later to sign a transaction.</p>
</p></div><div class="declaration"><h4 class="function" id="listDerivedIdentities"><code><span class="keyword">public func </span><span class="fnname">listDerivedIdentities</span>(<span class="parameter">lib</span> : <a href="#type.MetacallsLib"><span class="type">MetacallsLib</span></a>) : <span class="keyword">async </span><a href="#type.Result"><span class="type">Result</span></a>&lt;<a href="#type.ListDerivedIdentitiesResponse"><span class="type">ListDerivedIdentitiesResponse</span></a>&gt;</code></h4><p><p>List all the derived identities (t-ecdsa keys) that have been generated.</p>
</p></div><div class="declaration"><h4 class="function" id="createMessage"><code><span class="keyword">public func </span><span class="fnname">createMessage</span>(<span class="parameter">lib</span> : <a href="#type.MetacallsLib"><span class="type">MetacallsLib</span></a>, <span class="parameter">req</span> : <a href="#type.CreateMessageRequest"><span class="type">CreateMessageRequest</span></a>) : <span class="keyword">async </span><a href="#type.Result"><span class="type">Result</span></a>&lt;<a href="#type.CreateMessageResponse"><span class="type">CreateMessageResponse</span></a>&gt;</code></h4><p><p>Create a message which can be signed and sent later.</p>
</p></div><div class="declaration"><h4 class="function" id="signMessage"><code><span class="keyword">public func </span><span class="fnname">signMessage</span>(<span class="parameter">lib</span> : <a href="#type.MetacallsLib"><span class="type">MetacallsLib</span></a>, <span class="parameter">req</span> : <a href="#type.SignMessageRequest"><span class="type">SignMessageRequest</span></a>) : <span class="keyword">async </span><a href="#type.Result"><span class="type">Result</span></a>&lt;<a href="#type.SignMessageResponse"><span class="type">SignMessageResponse</span></a>&gt;</code></h4><p><p>Sign a message with the provided <code>key_name</code>.</p>
<p>Requirements:</p>
<ul><li>The message identified by the <code>uuid</code> must have already been created.</li><li>The key identified by the <code>key_name</code> must have already been created.</li><li>Enough cycles should exist to be able to call ic for signing.</li></ul></p></div><div class="declaration"><h4 class="function" id="sendOutgoingMessage"><code><span class="keyword">public func </span><span class="fnname">sendOutgoingMessage</span>(<span class="parameter">lib</span> : <a href="#type.MetacallsLib"><span class="type">MetacallsLib</span></a>, <span class="parameter">req</span> : <a href="#type.SendOutgoingMessageRequest"><span class="type">SendOutgoingMessageRequest</span></a>) : <span class="keyword">async </span><a href="#type.Result"><span class="type">Result</span></a>&lt;<a href="#type.SendOutgoingMessageResponse"><span class="type">SendOutgoingMessageResponse</span></a>&gt;</code></h4><p><p>Send a signed message to the provided http endpoint using <code>http_request</code>.</p>
<p>General Requirements:</p>
<ul><li>The message identified by the <code>uuid</code> must have already been created &amp; signed.</li><li>Enough cycles should exist to be able to call ic for <code>http_request</code>.</li></ul>

<p>Idempotency Requirements:</p>
<ul><li>Response from the http endpoint must be similar after applying the optional <code>transform</code> function.</li><li>Post requests must be idempotent since each replica makes the call.</li></ul></p></div><div class="declaration"><h4 class="function" id="listMessages"><code><span class="keyword">public func </span><span class="fnname">listMessages</span>(<span class="parameter">lib</span> : <a href="#type.MetacallsLib"><span class="type">MetacallsLib</span></a>) : <span class="keyword">async </span><a href="#type.Result"><span class="type">Result</span></a>&lt;<a href="#type.ListMessagesResponse"><span class="type">ListMessagesResponse</span></a>&gt;</code></h4><p><p>List all the messages stored in the state.</p>
</p></div><div class="declaration"><h4 class="function" id="updateMessageTtl"><code><span class="keyword">public func </span><span class="fnname">updateMessageTtl</span>(<span class="parameter">lib</span> : <a href="#type.MetacallsLib"><span class="type">MetacallsLib</span></a>, <span class="parameter">new_ttl_secs</span> : <span class="type">Int</span>) : <span class="keyword">async </span><a href="#type.Result"><span class="type">Result</span></a>&lt;()&gt;</code></h4><p><p>Update the <code>message_ttl_secs</code> config used to determine message expiration.</p>
</p></div><div class="declaration"><h4 class="function" id="cleanupExpiredMessages"><code><span class="keyword">public func </span><span class="fnname">cleanupExpiredMessages</span>(<span class="parameter">lib</span> : <a href="#type.MetacallsLib"><span class="type">MetacallsLib</span></a>) : <span class="keyword">async </span><a href="#type.Result"><span class="type">Result</span></a>&lt;<a href="#type.CleanupExpiredMessagesResponse"><span class="type">CleanupExpiredMessagesResponse</span></a>&gt;</code></h4><p><p>Trigger the cleanup of expired messages from the state.</p>
<p>The expiry of a message is determined based on its creation_ts and the <code>message_ttl_secs</code> config.</p>
</p></div></div></body></html>